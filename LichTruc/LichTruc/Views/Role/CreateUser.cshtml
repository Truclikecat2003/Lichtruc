@model LichTruc.Models.USER

@{
    ViewBag.Title = "Thêm người dùng vào vai trò";
}

<h2>Thêm người dùng vào vai trò</h2>

@using (Html.BeginForm())
{
    @Html.AntiForgeryToken()
    @Html.HiddenFor(m => m.role_id)

    <div class="form-group">
        @Html.LabelFor(m => m.username)
        @Html.TextBoxFor(m => m.username, new { @class = "form-control" })
    </div>

    <div class="form-group">
        @Html.LabelFor(m => m.password)
        @Html.PasswordFor(m => m.password, new { @class = "form-control" })
    </div>

    <div class="form-group">
        @Html.Label("Phòng ban chính")
        @Html.DropDownList("primary_dept_id", ViewBag.DepartmentList as SelectList, "-- Chọn phòng ban --", new { @class = "form-control", @id = "deptSelect" })
    </div>

    <div class="form-group">
        @Html.Label("Chọn nhân viên")
        @Html.DropDownList("emp_id", ViewBag.EmployeeList as SelectList, "-- Chọn nhân viên --", new { @class = "form-control", @id = "empSelect" })
    </div>

    <div class="form-check mt-2">
        <label class="form-check-label">
            @Html.CheckBox("is_active", Model.is_active ?? false, new { @class = "form-check-input" }) Kích hoạt
        </label>
    </div>

    <br />
    <button type="submit" class="btn btn-success">Lưu</button>
    @Html.ActionLink("Hủy", "Details", new { id = Model.role_id }, new { @class = "btn btn-secondary ml-2" })
}

@section Scripts {
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

    <script>
        $(document).ready(function () {
            $('#deptSelect, #empSelect').select2();

            $('#deptSelect').change(function () {
                var deptId = $(this).val();
                $.ajax({
                    url: '@Url.Action("GetEmployeesByDepartment", "Role")',
                    type: 'GET',
                    data: { deptId: deptId },
                    success: function (data) {
                        var empSelect = $('#empSelect');
                        empSelect.empty();
                        empSelect.append($('<option>', {
                            value: '',
                            text: '-- Chọn nhân viên --'
                        }));
                        $.each(data, function (i, emp) {
                            empSelect.append($('<option>', {
                                value: emp.Value,
                                text: emp.Text
                            }));
                        });
                        empSelect.trigger('change');
                    }
                });
            });
        });
    </script>
}
